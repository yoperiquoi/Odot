<?php
<<<<<<< HEAD

namespace controleur;

use modeles\gestionPersistance\TacheGateway;
use modeles\gestionPersistance\Connection;
use modeles\gestionPersistance\UtilisateurGateway;
use modeles\gestionTaches\Tache;
use modeles\gestionTaches\ListeTache;
use modeles\gestionUtilisateur\Utilisateur;
use config\Validation;


class Controleur
{


    function __construct()
    {
        //A enlever après
        $user = 'root';
        $pass = '';
        $dsn = 'mysql:host=localhost;dbname=OdotTest';



        global $rep, $vues, $css, $bootstrap, $dataVueErreur; // nécessaire pour utiliser variables globales
// on démarre ou reprend la session si necessaire (préférez utiliser un modèle pour gérer vos session ou cookies)
//        session_start();


        $TabErreur = array();

        try {
            $action = isset($_REQUEST['action']) ? $_REQUEST['action'] : NULL;
            $Gateway = new TacheGateway(new Connection($dsn, $user, $pass));
            $GatewayPrivee = new UtilisateurGateway(new Connection($dsn, $user, $pass));

            switch ($action) {

                case NULL:
                    $ListesPublique = $Gateway->findAllListes();
                    require($rep.$vues['pagePrincipale']);
                    break;

                case "ajouterListePublique":
                    $Nom=$_POST['AjoutListe'];

                    if(Validation::val_liste($Nom, $dataVueErreur)) {
                        try {
                            $Gateway->ajouterListe($Nom);
                        } catch (\Exception $e) {
                            $dataVueErreur['erreurListe'] = "Erreur non prise en charge : ".$e->getMessage();
                        }
                    }
                    $ListesPublique = $Gateway->findAllListes();
                    require($rep.$vues['pagePrincipale']);
                    break;

                case "supprimerListePublique":
                    $Nom = $_POST['NomListe'];

                    if(!Validation::val_suppressionListe($Nom, $dataVueErreur)) {
                        //Afficher la page d'erreur !!
                    } else {
                        try {
                            $Gateway->delListe($Nom);
                        } catch (\Exception $e) {
                            $dataVueErreur['pageErreur'] = "Erreur non prise en charge : ".$e->getMessage();
                            //Afficher page erreur
                        }
                    }
                    $ListesPublique = $Gateway->findAllListes();
                    require($rep.$vues['pagePrincipale']);
                    break;

                case "ajouterTachePublique":
                    $Nom=$_POST['Ajout'];
                    $Liste=$_POST['Liste'];

                    if(Validation::val_tache($Nom, $Liste, $dataVueErreur)) {
                        try {
                            $Gateway->ajoutTache($Liste,$Nom);
                        } catch (\Exception $e) {
                            $dataVueErreur['erreurTache'] = "Erreur non prise en charge : ".$e->getMessage();
                        }
                    }
                    $ListesPublique = $Gateway->findAllListes();
                    require($rep.$vues['pagePrincipale']);

                    break;

                case "supprimerTachePublique":
                    $Nom=$_POST['NomTache'];
                    //Faut pas mettre le nom de la liste dans laquelle supprimer ??

                    if(!Validation::val_suppressionTache($Nom, $Liste, $dataVueErreur)) {
                        //Afficher page erreur
                    } else {
                        try {
                            $TachesPublique=$Gateway->delTache($Nom);
                        } catch (\Exception $e) {
                            $dataVueErreur['pageErreur'] = "Erreur non prise en charge : ".$e->getMessage();
                            //Afficher page erreur
                        }
                    }

                    $ListesPublique = $Gateway->findAllListes();
                    require($rep.$vues['pagePrincipale']);
                    break;

                case "pageConnection":
                    require($rep.$vues['pageConnexion']);
                    break;

                case "seConnecter":
                    $Email = $_POST['inputEmail'];
                    $Mdp = $_POST['inputPassword'];

                    $Utilisateur=$GatewayPrivee->findUtilisateur($Email, $Mdp);

                    session_start();
                    $_SESSION['Utilisateur']=$Utilisateur->Email;
                    $ListesPrivee = $GatewayPrivee->findAllListesUtilisateur("yoann_63115@hotmail.fr");
                    require($rep.$vues['pagePrivee']);
                    break;

                case "pagePrivée":
                    $ListesPrivee = $GatewayPrivee->findAllListesUtilisateur("yoann_63115@hotmail.fr");
                    //if(isset($_SESSION['Utilisateur'])){
                    require($rep.$vues['pagePrivee']);
                    //}else{
                    //   require($rep.$vues['pageConnexion']);
                    //}
                    break;

                case "ajouterListePrivee":
                    $Nom=$_POST['AjoutListe'];
                    $GatewayPrivee->ajouterListe($Nom,"yoann_63115@hotmail.fr");

                    $ListesPrivee = $GatewayPrivee->findAllListesUtilisateur("yoann_63115@hotmail.fr");
                    require($rep.$vues['pagePrivee']);
                    break;

                case "supprimerListePrivee":
                    $Nom=$_POST['NomListe'];
                    $GatewayPrivee->delListe($Nom,"yoann_63115@hotmail.fr");

                    $ListesPrivee = $GatewayPrivee->findAllListesUtilisateur("yoann_63115@hotmail.fr");
                    require($rep.$vues['pagePrivee']);
                    break;

                case "ajouterTachePrivee":
                    $Nom=$_POST['Ajout'];
                    $Liste=$_POST['Liste'];
                    $GatewayPrivee->ajoutTache($Liste,$Nom);

                    $ListesPrivee = $GatewayPrivee->findAllListesUtilisateur("yoann_63115@hotmail.fr");
                    require($rep.$vues['pagePrivee']);
                    break;

                case "supprimerTachePrivee":
                    $Nom=$_POST['NomTache'];
                    $TachesPrivee=$GatewayPrivee->delTache($Nom);

                    $ListesPrivee = $GatewayPrivee->findAllListesUtilisateur("yoann_63115@hotmail.fr");
                    require($rep.$vues['pagePrivee']);
                    break;

                case "pageInscription":
                    require($rep.$vues['pageInscription']);
                    break;

                case "creerUtilisateur":
                    $Email=$_POST['inputEmail'];
                    $Mdp=$_POST['inputPassword'];
                    $Pseudo=$_POST['inputPseudo'];
                    $GatewayPrivee->ajoutUtilisateur($Email,$Pseudo,$Mdp);

                    $ListesPrivee = $GatewayPrivee->findAllListesUtilisateur("yoann_63115@hotmail.fr");
                    require($rep.$vues['pagePrivee']);
                    break;

//mauvaise action
                default:
                    $dataVueErreur['erreurAppel'] = "Erreur d'appel php";
                    require($rep.$vues['pagePrincipale']);
                    break;
            }
        } catch (Exception $e2) {
            $TabErreur[] = "Erreur métier ! ";
        }

    }

=======
//On récupére les identifiant et les localisation de la base de données
$user = 'root';
$pass = '';
$dsn = 'mysql:host=localhost;dbname=OdotTest';

//On require tout ce qui se trouve dans le métier et le fichier de configuration

require_once(__DIR__ . "/../modele/gestionPersistance/Connection.php");
require_once(__DIR__ . "/../modele/gestionTaches/Tache.php");
require_once(__DIR__ . "/../modele/gestionPersistance/TacheGateway.php");
require_once(__DIR__ . "/../modele/gestionPersistance/UtilisateurGateway.php");
require_once(__DIR__ . "/../modele/gestionTaches/ListeTache.php");
require_once(__DIR__ . "/../modele/gestionUtilisateur/Utilisateur.php");
require_once(__DIR__ . '/../config/Validation.php');
//On instancie un tableau d'erreur
$TabErreur=array();


try{
    //Je récupére l'action
    $action=$_REQUEST['action'];
    //Instancie les deux gateways responsable de la gestion des taches et des utilisateurs
    $Gateway=new TacheGateway(new Connection($dsn,$user,$pass));
    $GatewayPrivee=new UtilisateurGateway(new Connection($dsn,$user,$pass));
    //Je récupére les taches publiques
    $ListesPublique=$Gateway->findAllListes();
    //En fonction de l'action j'exécute différents scripts et j'affiche des vues
    switch($action) {

        case NULL:
            require('../vue/pagePrincipale/PagePrincipale.php');
            break;

        case "ajouterListePublique":
            include_once('../modele/gestionTaches/AjouterListe.php');
            require('../vue/pagePrincipale/PagePrincipale.php');
            break;

        case "supprimerListePublique":
            include_once('../modele/gestionTaches/SupprimerListe.php');
            require('../vue/pagePrincipale/PagePrincipale.php');
            break;

        case "ajouterTachePublique":
            include_once('../modele/gestionTaches/AjouterTache.php');
            require('../vue/pagePrincipale/PagePrincipale.php');
            break;

        case "supprimerTachePublique":
            include_once('../modele/gestionTaches/SupprimerTache.php');
            require('../vue/pagePrincipale/PagePrincipale.php');
            break;

        case "pageConnection":
            require('../vue/pageConnexion/PageConnexion.php');
            break;

        case "seConnecter":
            include_once('../modele/gestionUtilisateur/TrouverUtilisateur.php');
            $ListesPrivee=$GatewayPrivee->findAllListesUtilisateur("yoann_63115@hotmail.fr");
            require('../vue/pagePrivee/PagePrivee.php');
            break;

        case "pagePrivée":
            $ListesPrivee=$GatewayPrivee->findAllListesUtilisateur("yoann_63115@hotmail.fr");
            //if(isset($_SESSION['Utilisateur'])){
                require('../vue/pagePrivee/PagePrivee.php');
            //}else{
             //   require('../vue/pageConnexion/PageConnexion.php');
            //}
            break;

        case "ajouterListePrivee":
            include_once('../modele/gestionUtilisateur/AjouterListe.php');
            $ListesPrivee=$GatewayPrivee->findAllListesUtilisateur("yoann_63115@hotmail.fr");
            require('../vue/pagePrivee/PagePrivee.php');
            break;

        case "supprimerListePrivee":
            include_once('../modele/gestionUtilisateur/SupprimerListe.php');
            $ListesPrivee=$GatewayPrivee->findAllListesUtilisateur("yoann_63115@hotmail.fr");
            require('../vue/pagePrivee/PagePrivee.php');
            break;

        case "ajouterTachePrivee":
            include_once('../modele/gestionUtilisateur/AjouterTache.php');
            $ListesPrivee=$GatewayPrivee->findAllListesUtilisateur("yoann_63115@hotmail.fr");
            require('../vue/pagePrivee/PagePrivee.php');
            break;

        case "supprimerTachePrivee":
            include_once('../modele/gestionUtilisateur/SupprimerTache.php');
            $ListesPrivee=$GatewayPrivee->findAllListesUtilisateur("yoann_63115@hotmail.fr");
            require('../vue/pagePrivee/PagePrivee.php');
            break;

        case "pageInscription":
            require('../vue/pageInscription/PageInscription.php');
            $ListesPrivee=$GatewayPrivee->findAllListesUtilisateur("yoann_63115@hotmail.fr");
            break;

        case "créerUtilisateur":
            include_once('../modele/gestionUtilisateur/AjouterUtilisateur.php');
            $ListesPrivee=$GatewayPrivee->findAllListesUtilisateur("yoann_63115@hotmail.fr");
            require('../vue/pagePrivee/PagePrivee.php');
            break;

        //Si mauvaise action
        default:
            $dataVueErreur[] =	"Erreur d'appel php !";
            require (__DIR__.'../../vue/pagePrincipale/PagePrincipale.php');
            break;
    }
}catch (Exception $e2){ // Récupération des erreur venant du modèle et de l'interaction avec la BDD
    $dataVueErreur[]="Erreur métier ! ";
}catch (PDOException $e) {
    $dataVueErreur[] = "Erreur BDD ! ";
    require(__DIR__."/../../vue/pageErreur/PageErreur.php");
>>>>>>> 77fbfb8529bf6554e5deceea94ca12db8a7ed688
}